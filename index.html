<!DOCTYPE html>
<html lang="en">
<head>
    <title>HeyGen Avatar on AWS</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="data:,">
</head>

<body class="bg-gray-100 p-5 font-sans">
    <div class="max-w-3xl mx-auto bg-white p-5 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4">HeyGen Avatar RAG Assistant</h1>
        
        <div class="flex flex-wrap gap-2.5 mb-5">
            <input id="avatarID" type="text" placeholder="Avatar ID" value="Wayne_20240711" 
                   class="flex-1 min-w-[200px] p-2 border border-gray-300 rounded-md" />
            <input id="voiceID" type="text" placeholder="Voice ID" 
                   class="flex-1 min-w-[200px] p-2 border border-gray-300 rounded-md" />
            <button id="startBtn" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                Start
            </button>
            <button id="closeBtn" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">
                Close
            </button>
        </div>

        <div class="flex flex-wrap gap-2.5 mb-5">
            <input id="taskInput" type="text" placeholder="Ask me anything..." 
                   class="flex-1 min-w-[200px] p-2 border border-gray-300 rounded-md" />
            <button id="talkBtn" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                Send to AI
            </button>
        </div>

        <video id="mediaElement" class="w-full max-h-[400px] border rounded-lg my-5" autoplay playsinline></video>
        <div id="status" class="p-2.5 bg-gray-50 border border-gray-300 rounded-md h-[100px] overflow-y-auto font-mono text-sm"></div>
    </div>

    <script>
        // Mock HeyGen SDK for testing - replace with real SDK when working
        window.StreamingAvatar = class {
            constructor(options) {
                this.token = options.token;
                this.events = {};
            }
            
            on(event, callback) {
                this.events[event] = callback;
            }
            
            async createStartAvatar(config) {
                console.log('Mock: Starting avatar with config:', config);
                // Simulate stream ready event
                setTimeout(() => {
                    if (this.events['STREAM_READY']) {
                        // Create a mock video stream
                        const canvas = document.createElement('canvas');
                        canvas.width = 640;
                        canvas.height = 480;
                        const ctx = canvas.getContext('2d');
                        
                        // Draw a simple avatar placeholder
                        const drawFrame = () => {
                            ctx.fillStyle = '#4A90E2';
                            ctx.fillRect(0, 0, 640, 480);
                            ctx.fillStyle = 'white';
                            ctx.font = '24px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('HeyGen Avatar Placeholder', 320, 240);
                            ctx.fillText('Connected with token', 320, 280);
                            ctx.fillText(new Date().toLocaleTimeString(), 320, 320);
                            requestAnimationFrame(drawFrame);
                        };
                        drawFrame();
                        
                        const stream = canvas.captureStream(30);
                        this.events['STREAM_READY']({ detail: stream });
                    }
                }, 2000);
            }
            
            async speak(options) {
                console.log('Mock: Avatar speaking:', options.text);
                return { success: true };
            }
            
            async stopAvatar() {
                console.log('Mock: Stopping avatar');
            }
        };
        
        window.StreamingEvents = {
            STREAM_READY: 'STREAM_READY',
            AVATAR_START_TALKING: 'AVATAR_START_TALKING',
            AVATAR_STOP_TALKING: 'AVATAR_STOP_TALKING'
        };
    </script>
    <script src="script.js"></script>
</body>
</html>
